some changes in new_branch_ff
